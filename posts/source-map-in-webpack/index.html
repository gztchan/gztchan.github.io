<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.666 'Lora','Noto Serif SC','Geogria','Songti SC',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Lora','Noto Serif SC','Geogria','Songti SC',serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Lora','Noto Serif SC','Geogria','Songti SC',serif;font-weight:600;text-rendering:optimizeLegibility;font-size:32px;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Lora','Noto Serif SC','Geogria','Songti SC',serif;font-weight:600;text-rendering:optimizeLegibility;font-size:24px;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Lora','Noto Serif SC','Geogria','Songti SC',serif;font-weight:600;text-rendering:optimizeLegibility;font-size:20px;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Lora','Noto Serif SC','Geogria','Songti SC',serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Lora','Noto Serif SC','Geogria','Songti SC',serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;color:inherit;font-family:'Lora','Noto Serif SC','Geogria','Songti SC',serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}ul{margin-left:1.666rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.666rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;font-size:0.85rem;line-height:1.666rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;font-size:1rem;line-height:1.666rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}blockquote{margin-left:1.666rem;margin-right:1.666rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;font-size:0.85rem;font-style:italic;background-color:#f7f7f7;margin:1rem 0;padding:1.35362rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.666rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.666rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.666rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.666rem;margin-bottom:calc(1.666rem / 2);margin-top:calc(1.666rem / 2);}li > ul{margin-left:1.666rem;margin-bottom:calc(1.666rem / 2);margin-top:calc(1.666rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.666rem / 2);}code{font-size:0.85rem;line-height:1.666rem;}kbd{font-size:0.85rem;line-height:1.666rem;}samp{font-size:0.85rem;line-height:1.666rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.11067rem;padding-right:1.11067rem;padding-top:0.833rem;padding-bottom:calc(0.833rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#FF570D;font-weight:600;text-decoration:none;}blockquote > :last-child{margin-bottom:0;}</style><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=008654519ce705ac7bc44303a9014606"/><title data-react-helmet="true"></title><link rel="shortcut icon" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=008654519ce705ac7bc44303a9014606"/><meta name="generator" content="Gatsby 2.9.11"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=008654519ce705ac7bc44303a9014606"/><style data-href="/styles.116c48793f4e2750713a.css">nav a{text-decoration:none}nav a,nav a:hover{color:inherit;text-decoration:none}nav li,nav ul{padding:0;margin:0}nav li{display:inline}.avatar-module--wrap--20IfG{text-align:center;padding:20px 0}.avatar-module--wrap--20IfG img{margin:0;vertical-align:middle;width:136px;height:136px;border-radius:50%;background:#000;box-shadow:0 2px 10px rgba(0,0,0,.5)}.header-module--text--3lhrU{margin:0 auto;width:40%;text-align:center;font-size:.75rem}.header-module--text--3lhrU p{margin:0}.general-module--general--2ZGFK{width:100%;height:100vh;padding:1.25rem}.general-module--main--3PAVM{width:60%}.general-module--header--2xDbC{display:none;margin-bottom:20px}.general-module--sidemenu--2uZOh{top:0;right:0;width:40%;position:fixed}@media only screen and (max-width:1024px){.general-module--general--2ZGFK{padding:1rem}.general-module--main--3PAVM{width:100%}.general-module--sidemenu--2uZOh{display:none}.general-module--header--2xDbC{display:block}}.post-module--date--3ar7X{font-size:.95rem;color:rgba(0,0,0,.5)}.index-module--indexWrap--4x_eh{width:100%;height:100vh}</style><link href="//fonts.googleapis.com/css?family=Lora:200,400,600|Noto+Serif+SC:200,400,600" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/app-35989310d88ebb9d2c04.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-a2d2bc14819d5fd2edbd.js"/><link as="script" rel="preload" href="/styles-c55b11712fbc49e4c3e3.js"/><link as="script" rel="preload" href="/webpack-runtime-8e985eb47643707c0e9d.js"/><link as="fetch" rel="preload" href="/page-data/posts/source-map-in-webpack/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="general-module--general--2ZGFK"><main class="general-module--main--3PAVM"><div class="general-module--header--2xDbC"><header style="background:#f7f7f7"><div><div class="avatar-module--wrap--20IfG"><img src="https://gztchan.oss-ap-southeast-1.aliyuncs.com/img/WechatIMG1851.jpeg"/></div><div class="header-module--text--3lhrU"><p style="font-size:1rem;margin-bottom:1rem">Tony Chan</p><p>Excited to learn, research and make interesting things. 😝</p></div><nav style="text-align:center"><ul><li style="padding:20px 10px;margin:0 10px;display:inline-block"><a href="/">Home</a></li><li style="padding:20px 10px;margin:0 10px;display:inline-block"><a href="/posts">Posts</a></li></ul></nav></div></header></div><div><div><h1>Source Map in Webpack</h1><p class="post-module--date--3ar7X">April 28, 2017</p><div><h3>什么是 Source Map</h3>
<p>在现今的前端开发过程中，无论是开发环境或是生产环境，运行在浏览器（甚至 Node.js）中的代码（JavaScript, CSS, Less 等等），都经过了不同程度的转换或加工（特性转换、混淆、压缩）。那么当我们在定位问题位置时，就显得异常的困难。Source Map 便提供了一个快捷、高效的解决方案，既满足了代码的转换的同时，保持正常的开发体验。</p>
<p>Source Map 的原理是通过在构建时，通过一份特定的 .json 文件，记录构建前后代码的映射关系。 得益于浏览器的对其支持，通过开发者工具便能直接查看对应的代码位置。</p>
<p>浏览器（Chrome, FireFox, Safari 等）在加载 bundle 时，若 bundle 存在 <code>//# sourceMappingURL=?.map</code> 会同时加载对应的 <code>.map</code>  文件。Chrome 可在如下位置开启（默认开启）：</p>
<p><img src="//static.cnodejs.org/FpJ8zK0IjQcLaIOsTibv2AWOUUB8" alt="ec34ea6dgy1ff1pa1hdfhj20l70c9gn.jpg"></p>
<h3>Webpack 2.0+ 的 Source Map 配置项</h3>
<p>一共有 8 种 source map 配置策略，其中新增了 nosources-source-map 类型。</p>
<p><img src="//static.cnodejs.org/FkI26S4UagDzcPz7tMuTUCdlZH_l" alt="ec34ea6dgy1ff1pcgveplj20l509bgmn.jpg"></p>
<h3>Source Map 选项之间的区别</h3>
<blockquote>
<p>配合阅读，可以克隆 <a href="https://github.com/gztchan/source-map-explore">GitHub - gztchan/source-map-explore</a>  来查看区别。</p>
</blockquote>
<p>不同选项之间差别主要体现在 source map 策略的质量（源码定位，构建与再构建速度等），这些选项之间通常都是互相约束的。</p>
<ol>
<li><code>eval</code>: 使用 <code>eval</code> 包裹源码，并在文件尾部添加 source map 文件位置或编码后的 source map 信息。</li>
<li><code>cheap</code> 转换（loader）代码，不支持列信息，且不使用 loader 自身的 source map。</li>
<li><code>module</code> 使经过转换后得代码（loader）映射到源代码。</li>
</ol>
<p><strong>eval</strong>
生成文件：bundle（eval 包裹）
Source URL：fileURL（源码文件）
错误追踪：文件名、源码行和列位置</p>
<pre><code class="language-js">// main.js

// 不同模块都被 eval 分别包裹
// 每个模块尾部都包含 # sourceURL='...'

/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  var a = { exited: function exited() {\n      console.log('moduleA: hello!');\n    } };\n  a.exited();a.methodNotExisted();\n};\n\n//////////////////\n// WEBPACK FOOTER\n// ./moduleA.js\n// module id = 0\n// module chunks = 0\n\n//# sourceURL=webpack:///./moduleA.js?");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nvar _moduleA = __webpack_require__(0);\n\nvar _moduleA2 = _interopRequireDefault(_moduleA);\n\nfunction _interopRequireDefault(obj) { return obj &#x26;&#x26; obj.__esModule ? obj : { default: obj }; }\n\n(0, _moduleA2.default)();\n\n//////////////////\n// WEBPACK FOOTER\n// ./index.js\n// module id = 1\n// module chunks = 0\n\n//# sourceURL=webpack:///./index.js?");

/***/ })
/******/ ]);
</code></pre>
<p><strong>cheap-source-map</strong>
生成文件：bundle 和对应 source-map
Source Map 方式：dataURL（base64）
Sources Content：转换后的代码、源码文件名
错误追踪：行位置（转换后）</p>
<pre><code class="language-js">// main.js

// 转换后得模块
// 文件尾部 //# sourceMappingURL=main.js.map 指向 source map 文件

/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function () {
  var a = { exited: function exited() {
      console.log('moduleA: hello!');
    } };
  a.exited();a.methodNotExisted();
};

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _moduleA = __webpack_require__(0);

var _moduleA2 = _interopRequireDefault(_moduleA);

function _interopRequireDefault(obj) { return obj &#x26;&#x26; obj.__esModule ? obj : { default: obj }; }

(0, _moduleA2.default)();

/***/ })
/******/ ]);
//# sourceMappingURL=main.js.map
</code></pre>
<pre><code class="language-js">// main.js.map

// sourcesContent 为转换后的代码
// mappings 忽略列信息

{
  "version": 3,
  "file": "main.js",
  "sources": [
    "webpack:///webpack/bootstrap 8980c336e190bdb173b1",
    "webpack:///./moduleA.js",
    "webpack:///./index.js"
  ],
  "sourcesContent": [
    "...",
    "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  var a = { exited: function exited() {\n      console.log('moduleA: hello!');\n    } };\n  a.exited();a.methodNotExisted();\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./moduleA.js\n// module id = 0\n// module chunks = 0",
    "'use strict';\n\nvar _moduleA = require('./moduleA.js');\n\nvar _moduleA2 = _interopRequireDefault(_moduleA);\n\nfunction _interopRequireDefault(obj) { return obj &#x26;&#x26; obj.__esModule ? obj : { default: obj }; }\n\n(0, _moduleA2.default)();\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./index.js\n// module id = 1\n// module chunks = 0"
  ],
  "mappings": ";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A;;;;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A",
  "sourceRoot": ""
}
</code></pre>
<p><strong>cheap-eval-source-map</strong>
生成文件：bundle（eval 包裹）
Source Map 方式：dataURL（base64）
Sources Content：转后的代码、源码文件名
错误追踪：行位置（转换后 ）</p>
<pre><code class="language-js">// main.js

// 在 eval 的基础上，尾部的 //# sourceMappingURL=dataURL, 不生成 source map 文件

/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  var a = { exited: function exited() {\n      console.log('moduleA: hello!');\n    } };\n  a.exited();a.methodNotExisted();\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL21vZHVsZUEuanM/ODU0MSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGEgPSB7IGV4aXRlZDogZnVuY3Rpb24gZXhpdGVkKCkge1xuICAgICAgY29uc29sZS5sb2coJ21vZHVsZUE6IGhlbGxvIScpO1xuICAgIH0gfTtcbiAgYS5leGl0ZWQoKTthLm1ldGhvZE5vdEV4aXN0ZWQoKTtcbn07XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVBLmpzXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nvar _moduleA = __webpack_require__(0);\n\nvar _moduleA2 = _interopRequireDefault(_moduleA);\n\nfunction _interopRequireDefault(obj) { return obj &#x26;&#x26; obj.__esModule ? obj : { default: obj }; }\n\n(0, _moduleA2.default)();//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2luZGV4LmpzPzY0OTkiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgX21vZHVsZUEgPSByZXF1aXJlKCcuL21vZHVsZUEuanMnKTtcblxudmFyIF9tb2R1bGVBMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX21vZHVsZUEpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG4oMCwgX21vZHVsZUEyLmRlZmF1bHQpKCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9pbmRleC5qc1xuLy8gbW9kdWxlIGlkID0gMVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ })
/******/ ]);
</code></pre>
<p><strong>cheap-module-eval-source-map</strong>
生成文件：bundle （eval 包裹）
Source Map 方式：dataURL（base64）
Sources Content：源代码、源码文件名
错误追踪：文件名、源码行位置</p>
<pre><code class="language-js">// main.js

// 与 cheap-eval-source-map 对比，经过 base64 编码的 source map 体积下降了（忽略列信息）

/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  var a = { exited: function exited() {\n      console.log('moduleA: hello!');\n    } };\n  a.exited();a.methodNotExisted();\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9tb2R1bGVBLmpzPzg2M2IiXSwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgZGVmYXVsdCAoKSA9PiB7XG4gIGNvbnN0IGEgPSB7IGV4aXRlZDogKCkgPT4geyBjb25zb2xlLmxvZygnbW9kdWxlQTogaGVsbG8hJyl9IH07XG4gIGEuZXhpdGVkKCk7IGEubWV0aG9kTm90RXhpc3RlZCgpO1xufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIG1vZHVsZUEuanMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nvar _moduleA = __webpack_require__(0);\n\nvar _moduleA2 = _interopRequireDefault(_moduleA);\n\nfunction _interopRequireDefault(obj) { return obj &#x26;&#x26; obj.__esModule ? obj : { default: obj }; }\n\n(0, _moduleA2.default)();//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9pbmRleC5qcz8xNjg3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb2R1bGVBU2F5SGVsbG8gZnJvbSAnLi9tb2R1bGVBLmpzJztcblxubW9kdWxlQVNheUhlbGxvKCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gaW5kZXguanMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7Ozs7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==");

/***/ })
/******/ ]);
</code></pre>
<p><strong>cheap-module-source-map</strong>
生成文件：bundle 和 source-map
Source Map 方式：fileURL
Sources Content：源代码、源码文件名
错误追踪：文件名、源码行位置</p>
<pre><code class="language-js">/* 0 */
/***/ (function(module, exports, __webpack_require__) {

...

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

...

/***/ })
/******/ ]);
//# sourceMappingURL=main.js.map
</code></pre>
<pre><code class="language-js">// main.js.map

{
  "version": 3,
  "file": "main.js",
  "sources": [
    "webpack:///webpack/bootstrap 8980c336e190bdb173b1",
    "webpack:///moduleA.js",
    "webpack:///index.js"
  ],
  "sourcesContent": [
    "...",
    "\nexport default () => {\n  const a = { exited: () => { console.log('moduleA: hello!')} };\n  a.exited(); a.methodNotExisted();\n}\n\n\n\n// WEBPACK FOOTER //\n// moduleA.js",
    "import moduleASayHello from './moduleA.js';\n\nmoduleASayHello();\n\n\n\n// WEBPACK FOOTER //\n// index.js"
  ],
  "mappings": ";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A;;;;;;;;;;;AC/DA;AACA;AAAA;AAAA;AACA;AACA;;;;;;;;;ACJA;AACA;;;;;AACA;;;A",
  "sourceRoot": ""
}
</code></pre>
<p><strong>eval-source-map</strong>
生成文件：bundle（eval 包裹）
Source Map 方式：dataURL（base64）
Sources Content：源代码、源代码文件名
错误追踪：文件名、源码行和列位置</p>
<pre><code class="language-js">// main.js

// sourcesContent 包含未被转换的源码
// 包含没有去掉列信息的 source map

/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function () {\n  var a = { exited: function exited() {\n      console.log('moduleA: hello!');\n    } };\n  a.exited();a.methodNotExisted();\n};//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9tb2R1bGVBLmpzPzZlOWQiXSwibmFtZXMiOlsiYSIsImV4aXRlZCIsImNvbnNvbGUiLCJsb2ciLCJtZXRob2ROb3RFeGlzdGVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7a0JBQ2UsWUFBTTtBQUNuQixNQUFNQSxJQUFJLEVBQUVDLFFBQVEsa0JBQU07QUFBRUMsY0FBUUMsR0FBUixDQUFZLGlCQUFaO0FBQStCLEtBQWpELEVBQVY7QUFDQUgsSUFBRUMsTUFBRixHQUFZRCxFQUFFSSxnQkFBRjtBQUNiLEMiLCJmaWxlIjoiMC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGRlZmF1bHQgKCkgPT4ge1xuICBjb25zdCBhID0geyBleGl0ZWQ6ICgpID0+IHsgY29uc29sZS5sb2coJ21vZHVsZUE6IGhlbGxvIScpfSB9O1xuICBhLmV4aXRlZCgpOyBhLm1ldGhvZE5vdEV4aXN0ZWQoKTtcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL21vZHVsZUEuanMiXSwic291cmNlUm9vdCI6IiJ9");

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nvar _moduleA = __webpack_require__(0);\n\nvar _moduleA2 = _interopRequireDefault(_moduleA);\n\nfunction _interopRequireDefault(obj) { return obj &#x26;&#x26; obj.__esModule ? obj : { default: obj }; }\n\n(0, _moduleA2.default)();//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9pbmRleC5qcz8yNjQ1Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7OztBQUVBIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9kdWxlQVNheUhlbGxvIGZyb20gJy4vbW9kdWxlQS5qcyc7XG5cbm1vZHVsZUFTYXlIZWxsbygpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vaW5kZXguanMiXSwic291cmNlUm9vdCI6IiJ9");

/***/ })
/******/ ]);
</code></pre>
<p><strong>source-map</strong>
生成文件：bundle 和对应 source map
Source Map 方式：fileURL
Sources Content：源代码、源码文件名
错误追踪：文件名、源码行和列位置</p>
<pre><code class="language-js">// main.js

/* 0 */
/***/ (function(module, exports, __webpack_require__) {

...

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

...

/***/ })
/******/ ]);
//# sourceMappingURL=main.js.map
</code></pre>
<pre><code class="language-js">// main.js.map
// 最完整的 source map 信息
// sourcesContent 是源码

{
  "version": 3,
  "sources": [
    "webpack:///webpack/bootstrap 8980c336e190bdb173b1",
    "webpack:///./moduleA.js",
    "webpack:///./index.js"
  ],
  "names": [
    "a",
    "exited",
    "console",
    "log",
    "methodNotExisted"
  ],
  "mappings": ";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;kBC/De,YAAM;AACnB,MAAMA,IAAI,EAAEC,QAAQ,kBAAM;AAAEC,cAAQC,GAAR,CAAY,iBAAZ;AAA+B,KAAjD,EAAV;AACAH,IAAEC,MAAF,GAAYD,EAAEI,gBAAF;AACb,C;;;;;;;;;ACJD;;;;;;AAEA,yB",
  "file": "main.js",
  "sourcesContent": [
    "...",
    "\nexport default () => {\n  const a = { exited: () => { console.log('moduleA: hello!')} };\n  a.exited(); a.methodNotExisted();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./moduleA.js",
    "import moduleASayHello from './moduleA.js';\n\nmoduleASayHello();\n\n\n\n// WEBPACK FOOTER //\n// ./index.js"
  ],
  "sourceRoot": ""
}
</code></pre>
<p><strong>nosources-source-map</strong>
生成文件：bundle 和 对应 source map
Source Map 方式：fileURL
Sources Content：空
错误追踪：由于不产生 sourcesContent，所以无法定位</p>
<pre><code class="language-js">// main.js.map

// 其他信息与 source-map 保持一致，缺少了 sourcesContent

{
  "version": 3,
  "sources": [
    "webpack:///webpack/bootstrap 8980c336e190bdb173b1",
    "webpack:///./moduleA.js",
    "webpack:///./index.js"
  ],
  "names": [
    "a",
    "exited",
    "console",
    "log",
    "methodNotExisted"
  ],
  "mappings": ";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;kBC/De,YAAM;AACnB,MAAMA,IAAI,EAAEC,QAAQ,kBAAM;AAAEC,cAAQC,GAAR,CAAY,iBAAZ;AAA+B,KAAjD,EAAV;AACAH,IAAEC,MAAF,GAAYD,EAAEI,gBAAF;AACb,C;;;;;;;;;ACJD;;;;;;AAEA,yB",
  "file": "main.js",
  "sourceRoot": ""
}
</code></pre>
<h3>根据环境配置 Source Map</h3>
<p><strong>开发环境</strong>
需求：</p>
<ol>
<li>快速 build 与 rebuild 速度（配合 HMR）</li>
<li>清晰的 debug 定位信息</li>
<li>尽可能小的 bundle 和 source map 体积</li>
</ol>
<p><code>eval</code> 优势是快速构建速度，但如果直接使用 <code>eval-source-map</code>  会导致在 bundle 尾部的 dataURL 过大（包含源代码），导致包体积增大。<code>cheap-source-map</code> 直接得出转换后得代码，由于经过转换，在 debug 时，代码定位不直观。通过 <code>cheap-module-source-map</code> 后在 sourcesContent 中可查看源代码。另外，<code>cheap-source-map</code> 中 sourcesContent 的体积也相对 <code>cheap-moudle-source-map</code> 中的要较大（转换）。结合 <code>eval</code> 可以把 devtool 配置为 <code>cheap-module-eval-source-map</code>，既能保证一定的 build 与rebuild 速度，同时能确保在 debug 时正确定位代码位置，又能相对地降低 source map 的体积。</p>
<p>推荐使用：<code>cheap-module-eval-source-map</code></p>
<p><strong>生产环境</strong>
需求：</p>
<ol>
<li>清晰的 debug 定位信息</li>
<li>尽可能小的 bundle 且只包含 source map 加载链接</li>
<li>在打开 {Browser} Dev Tool 时才加载 source map</li>
</ol>
<p><code>eval</code> 的方式不适合在生产环境使用（鉴于 <code>eval</code> 本身的安全性和性能等问题），<code>source-map</code>  与 <code>cheap-module-source-map</code> 的区别在于后者会忽略代码的列信息。source map 通过 mappings 保存转换前后字符的对应位置（Base64 VLQ 编码）。当文件越大，需要记录的位置也越多，就会导致 source map 文件过大，从而降低项目构建性能。在 debug 时，列信息较行信息的重要新更低，可以忽略处理。</p>
<p>推荐使用：<code>cheap-module-eval-source-map</code></p>
<h2>参考</h2>
<p><a href="https://www.wikiwand.com/en/Variable-length_quantity">Wikipedia VLQ Algorithm</a>
<a href="https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">Introduction to JavaScript Source Maps - HTML5 Rocks</a>
<a href="https://survivejs.com/webpack/building/source-maps/">Source Maps</a>
<a href="https://webpack.js.org/configuration/devtool/">Webpack Devtool</a></p></div></div></div></main></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/source-map-in-webpack";window.webpackCompilationHash="11f1caa64820db7379f5";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-35989310d88ebb9d2c04.js"],"component---src-templates-photo-js":["/component---src-templates-photo-js-93d7f5f14b7d81d0a31c.js"],"component---src-templates-post-js":["/component---src-templates-post-js-a2d2bc14819d5fd2edbd.js"],"component---src-pages-404-js":["/component---src-pages-404-js-b6b2061b65f38b4289c3.js"],"component---src-pages-about-js":["/component---src-pages-about-js-bdf51ca77c3389fe61b8.js"],"component---src-pages-gallery-js":["/component---src-pages-gallery-js-7771ea965a656d6047c1.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d1c1abb82b68bd673ce0.js"],"component---src-pages-posts-js":["/component---src-pages-posts-js-d8ec3bca164a33475dbe.js"]};/*]]>*/</script><script src="/webpack-runtime-8e985eb47643707c0e9d.js" async=""></script><script src="/styles-c55b11712fbc49e4c3e3.js" async=""></script><script src="/component---src-templates-post-js-a2d2bc14819d5fd2edbd.js" async=""></script><script src="/app-35989310d88ebb9d2c04.js" async=""></script></body></html>